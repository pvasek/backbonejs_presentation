<div class="navigator">
    <a class="previous"><i class="icon-arrow-left"></i></a>
    <a class="next"><i class="icon-arrow-right"></i></a>
</div>
<div class="slide">
    <h1 class="main center">Backbone.js</h1>
    <h2 class="center">Minimalistic library for single page apps</h2>
    <h2 class="center">PREVIEW - work in progress :)</h2>
</div>

<div class="slide">
    <h1>Backbone.js</h1>
    <ul>
        <li>Enables structure your web applications</li>
        <li>Best situated for REST based apps</li>
        <li>Doesn't try to solve everything</li>
        <li>Tiny with minimal dependencies (10.3kB including underscore)</li>
    </ul>
</div>

<div class="slide">
    <h1>Dependencies</h1>
    <ul>
        <li>Mandatory: underscore or Lo-Dash</li>
        <li>"Optional": jQuery or Zepto</li>
    </ul>
</div>

<div class="slide">
    <h1>Size</h1>
    <table>
        <tr>
            <td>Backbone.js</td>
            <td>6.3 kB</td>
        </tr>
        <tr>
            <td>Underscore.js</td>
            <td>4 kB</td>
        </tr>
        <tr>
            <td>Zepto</td>
            <td>8.4 kB</td>
        </tr>
    </table>
</div>

<div class="slide">
    <h1>The main parts</h1>
    <ul>
        <li>Events</li>
        <li>Model</li>
        <li>Collection</li>
        <li>Router</li>
        <li>History</li>
    </ul>
</div>

<div class="slide">
    <h1 class="main center">Events</h1>
    <!--<h2 class="center">Minimalistic library for single page apps</h2>-->
</div>

<div class="slide">
    <div class="title-inline">
        <h1>Events</h1>
        <h3>overview</h3>
    </div>
    <ul>
        <li>Publish/Subscribe design pattern</li>
        <li>Enables connect different parts of the page together</li>
        <li>The parts need to know only about the event object (broker)</li>
        <li>You can bind multiple events at once "event1 event2"</li>
    </ul>
</div>

<div class="slide">
    <div class="title-inline">
        <h1>Events</h1>
        <h3>methods</h3>
    </div>
    <ul>
        <li>On(event, callback, [context]) - subscribe to an event</li>
        <li>Off([event], [callback], [context]) - unsubscribe from an event</li>
        <li>trigger(event, [param1], [param2], ...) - triggers the an event</li>
    </ul>
</div>

<!--
<div class="slide">
    <div class="title-inline">
        <h1>Events</h1>
        <h3>Methods</h3>
    </div>
    <ul>
        <li>Once(event, callback, [context]) - subscribe to only the first event</li>
        <li>listenTo(other, event, callback) - object listening to an event</li>
        <li>stopListening([other], [event], [callback]) - object stops listening to an event</li>
    </ul>
</div>
-->

<div class="slide slide-compact eventExample1">
    <div class="title-inline">
        <h1>Events</h1>
        <h3>example 1</h3>
    </div>
    <div class="left-side">
        <table class="action table">
            <tr><td><a href="#" class="publisher1">Publisher1 (event1)</a></td></tr>
            <tr><td><a href="#" class="publisher2">Publisher2 (event2)</a></td></tr>
        </table>
        <textarea rows="15" class="log"></textarea>
    </div>
    <pre data-code="events.example1" class="left-side">
    </pre>
</div>

<script type="text/javascript">
    example('.eventExample1', function($) {
        var $log = $('.log');
        function log(text) {
            $log.val($log.val() + text + '\n');
        }
        //--start events.example1
        var broker = {};
        _.extend(broker, Backbone.Events);

        $('.publisher1').click(function(){
            broker.trigger('event1',
                    "event1-param1", 10);
        });
        $('.publisher2').click(function(){
            broker.trigger('event2', "event2-param1");
        });
        broker.on('event1', function(p1, p2) {
            log('subscriber1:');
            log('   p1: ' + p1 + ', p2: ' + p2);
        });
        broker.on('event1 event2', function(p1, p2) {
            log('subscriber2:');
            log('   p1: ' + p1 + ', p2: ' + p2);
        });
        //--end
    });
</script>

<div class="slide slide-compact eventExample2">
    <div class="title-inline">
        <h1>Events</h1>
        <h3>example2</h3>
    </div>
    <div class="actions">
        <div class="navbar">
            <div class="navbar-inner">
                <span class="selected-count"></span> <a class="btn btn-delete disabled" href="">Delete</a>
            </div>
        </div>
        <table class="table">
            <tbody>
            <tr>
                <td><input type="checkbox"></td>
                <td>Project1</td>
            </tr>
            <tr>
                <td><input type="checkbox"></td>
                <td>Project2</td>
            </tr>
            <tr>
                <td><input type="checkbox"></td>
                <td>Project3</td>
            </tr>
            </tbody>
        </table>
    </div>
    <div class="left-side">
        <p>Global configuration:</p>
        <pre data-code="events.example2.part1"></pre>
        <p>Toolbar part:</p>
        <pre data-code="events.example2.part2"></pre>
        <p>Table part:</p>
        <pre data-code="events.example2.part3"></pre>
    </div>
</div>

<script type="text/javascript">
    example('.eventExample2', function($) {
        //--start events.example2.part1
        var globalEvents = {};
        _.extend(globalEvents, Backbone.Events);
        //--end

        //--start events.example2.part2
        globalEvents.on('selection:changed', function(count){
            $('.btn-delete').toggleClass('disabled', count == 0);
            $('.selected-count').html(count == 0 ? '' : count);
        });
        //--end

        $('input').change(function(){
            var selectedCount = $(':checked').length;
            //--start events.example2.part3
            globalEvents.trigger('selection:changed', selectedCount);
            //--end
        });
    });
</script>

<div class="slide">
    <h1 class="main center">REST</h1>
    <h2 class="center">Recapitulation</h2>
</div>

<div class="slide">
    <div class="title-inline">
        <h1>REST</h1>
    </div>
    <ul>
        <li>Representational state transfer</li>
        <li>Old good HTTP 1.1</li>
        <li>Verbs: GET, POST, PUT, DELETE</li>
    </ul>
</div>

<div class="slide rest-example">
    <div class="title-inline">
        <h1>REST</h1>
        <h3>example</h3>
    </div>
    <div>
        <table class="action table left-side">
            <tr><td><a href="#" class="get">GET /project</a></td></tr>
            <tr><td><a href="#" class="get1">GET /project/1</a></td></tr>
            <tr><td><a href="#" class="put1">PUT /project/1</a></td></tr>
            <tr><td><a href="#" class="post">POST /project</a></td></tr>
            <tr><td><a href="#" class="clear">Clear</a></td></tr>
        </table>
        <div class="left-side">
            <textarea class="rest-text" cols="80" rows="13" data-placeholder="examples"></textarea>
        </div>
    </div>
</div>

<script type="text/javascript">
example('.rest-example', function($){
    var $textarea = $('textarea');
    $('.get').on('click', function(){
        var opt = {
            url: '/project',
            type: 'get'
        };
        jQuery.ajax(opt)
                .done(function(data){
                    $textarea.val(JSON.stringify(data));
                });
    });
    $('.get1').on('click', function(){
        var opt = {
            url: '/project/1',
            type: 'get'
        };
        jQuery.ajax(opt)
            .done(function(data){
                $textarea.val(JSON.stringify(data));
            });
    });
    $('.put1').on('click', function(){
        var opt = {
            url: '/project/1',
            type: 'put',
            contentType: 'application/json',
            data: $textarea.val()
        };
        jQuery.ajax(opt);
    });
    $('.post').on('click', function(){
        var opt = {
            url: '/project',
            type: 'post',
            contentType: 'application/json',
            data: $textarea.val()
        };
        jQuery.ajax(opt).done(function(data){
            $textarea.val(JSON.stringify(data));
        });
    });
    $('.clear').on('click', function(){
        $textarea.val('');
    });
});
</script>

<div class="slide">
    <h1>Model</h1>
    <ul>
        <li>Representation of your entity on the client</li>
        <li>Knows how to save/load itself
            <ul>
                <li>Use Backbone.sync method</li>
                <li>Default implementation uses REST</li>
                <li>Can be replaced by anything you want</li>
            </ul>
        </li>
        <li>Uses events for notifying about changes</li>
        <li>Has attributes object for storing attribute values, use toJSON() to get them</li>
    </ul>
</div>

<div class="slide model-example">
    <div class="title-inline">
        <h1>Model</h1>
        <h3>methods</h3>
    </div>
    <ul>
        <li>Fetch - loads entity attributes from server</li>
        <li>Save - save entity to the server</li>
        <li>Save(attributes) - set attributes and save to the server</li>
        <li>Get(property) - for getting property value</li>
        <li>Set(property,value) - set property value</li>
        <li>Set(attributes) - setting multiple properties</li>
        <li>Your methods</li>
    </ul>
</div>

<div class="slide">
    <div class="title-inline">
        <h1>Model</h1>
        <h3>example</h3>
    </div>
    <div>
        <p>Model definition:</p>
        <pre data-code="model.example1"></pre>
    </div>
</div>

<div class="slide slide-compact model-example">
    <div class="title-inline">
        <h1>Model</h1>
        <h3>example</h3>
    </div>
    <div>
        <div class="left-side">
            <p>Example methods:</p>
            <table class="action table">
                <tr><td><a href="#" class="get">project.get('name')</a></td></tr>
                <tr><td><a href="#" class="set1">project.set('name', 'Project A')</a></td></tr>
                <tr><td><a href="#" class="set2">project.set({name: 'Project B'})</a></td></tr>
                <tr><td><a href="#" class="fetch">project.fetch()</a></td></tr>
                <tr><td><a href="#" class="save">project.save()</a></td></tr>
                <tr><td><a href="#" class="clear">project.clear()</a></td></tr>
                <tr><td><a href="#" class="output-clear">Clear Output</a></td></tr>
            </table>
        </div>
        <div class="left-side">
            <p>Output:</p>
            <textarea class="target rest-text" rows="8" data-placeholder="examples"></textarea>
            <p>Event Log:</p>
            <textarea class="log rest-text" rows="6" placeholder="Loging window"></textarea>
        </div>
    </div>
</div>

<script type="text/javascript">
    example('.model-example', function($) {
        var $code = $(".target");
        var $log = $(".log");

        function log(text) {
            $log.val($log.val() + text + '\n');
        }

        //--start model.example1
        var Project = Backbone.Model.extend({
            urlRoot: '/project'
        });

        var project = new Project({id: 1});
        project.fetch();

        project.on('all', function(event){
            log(event);
        });
        //--end

        $(".fetch").click(function(e){
            e.preventDefault();
            project.fetch().done(function(){
                $code.val(JSON.stringify(project.toJSON()));
            });
        });
        $(".save").click(function(e){
            e.preventDefault();
            project.set(JSON.parse($code.val()));
            project.save().done(function(){
                $code.val(JSON.stringify(project.toJSON()));
            });
        });
        $(".set1").click(function(e){
            e.preventDefault();
            project.set('name', 'Project A');
            $code.val(JSON.stringify(project.toJSON()));
        });
        $(".set2").click(function(e){
            e.preventDefault();
            project.set({name: 'Project B'});
            $code.val(JSON.stringify(project.toJSON()));
        });
        $(".get").click(function(e){
            e.preventDefault();
            $code.val(project.get('name'));
        });
        $(".clear").click(function(e){
            e.preventDefault();
            project.clear();
            $code.val(JSON.stringify(project.toJSON()));
        });
        $(".output-clear").click(function(e){
            e.preventDefault();
            $code.val('');
            $log.val('');
        });
    });
</script>

<div class="slide">
    <h1>Collection</h1>
    <ul>
        <li>Bootstraps your collections</li>
    </ul>
</div>